{{- $profile := .Site.Params.home.profile -}}
<div class="home-profile">
    {{- /* 头像部分 */ -}}
    {{- $avatar := $profile.avatarURL -}}
    {{- with $profile.gravatarEmail -}}
        {{- $avatar = md5 . | printf "https://www.gravatar.com/avatar/%v?s=240&d=mp" -}}
    {{- end -}}
    {{- if $avatar -}}
        <div class="home-avatar">
            {{- $menus := $.Site.Menus.main | default slice -}}
            {{- with index $menus 0 -}}
                <a href="{{ .URL | relLangURL }}">
                    {{- dict "Src" $avatar | partial "plugin/image.html" -}}
                </a>
            {{- else -}}
                {{- dict "Src" $avatar | partial "plugin/image.html" -}}
            {{- end -}}
        </div>
    {{- end -}}

    <h1 class="home-title">{{- $profile.title | default .Site.Title | safeHTML -}}</h1>

    <div class="links">
        {{- $socialMap := resources.Get "data/social.yml" | transform.Unmarshal -}}
        {{- range $key, $value := .Site.Params.social -}}
            {{- if $value -}}
                {{- /* 尝试三种路径：原始名、首字母大写、全小写 */ -}}
                {{- $fileNames := slice $key (printf "%s%s" (substr $key 0 1 | upper) (substr $key 1)) ($key | lower) -}}
                {{- $customSvg := false -}}
                
                {{- range $fileNames -}}
                    {{- if not $customSvg -}}
                        {{- $customSvg = resources.Get (printf "svg/%s.svg" .) -}}
                    {{- end -}}
                {{- end -}}
                
                {{- if $customSvg -}}
                    {{- /* 只有成功抓取到 SVG 对象才渲染，绝不报错 */ -}}
                    <a href="{{ if reflect.IsMap $value }}{{ $value.prefix }}{{ $value.id }}{{ else }}{{ $value }}{{ end }}" title="{{ $key }}" target="_blank" rel="noopener noreffer me" class="social-icon-link">
                        <span class="custom-icon-box {{ $key | lower }}">
                            {{- $customSvg.Content | safeHTML -}}
                        </span>
                    </a>
                {{- else -}}
                    {{- /* 找不到自定义文件则走内置 Email 逻辑 */ -}}
                    {{- $social := index $socialMap ($key | lower) | default dict -}}
                    {{- if reflect.IsMap $value -}}
                        {{- $social = merge $social $value -}}
                    {{- else if ne $value true -}}
                        {{- $social = dict "Id" $value | merge $social -}}
                    {{- end -}}
                    {{- partial "plugin/social.html" $social -}}
                {{- end -}}
            {{- end -}}
        {{- end -}}
    </div>
</div>

<style>
    .links {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 22px;
        margin-top: 1.2rem;
    }
    .custom-icon-box {
        display: flex;
        width: 1.9rem;
        height: 1.9rem;
        fill: currentColor;
    }
    .custom-icon-box svg { width: 100%; height: auto; transform: scale(1.15); }
</style>
