{{- $profile := .Site.Params.home.profile -}}
<div class="home-profile">
    {{- /* 1. 头像部分 (完全原版) */ -}}
    {{- $avatar := $profile.avatarURL -}}
    {{- with $profile.gravatarEmail -}}
        {{- $avatar = md5 . | printf "https://www.gravatar.com/avatar/%v?s=240&d=mp" -}}
    {{- end -}}
    {{- if $avatar -}}
        <div class="home-avatar">
            {{- $menus := $.Site.Menus.main | default slice -}}
            {{- with index $menus 0 -}}
                <a href="{{ .URL | relLangURL }}">{{- dict "Src" $avatar | partial "plugin/image.html" -}}</a>
            {{- else -}}
                {{- dict "Src" $avatar | partial "plugin/image.html" -}}
            {{- end -}}
        </div>
    {{- end -}}

    <h1 class="home-title">{{- $profile.title | default .Site.Title | safeHTML -}}</h1>

    {{- /* 2. 副标题 (完全原版) */ -}}
    {{- with $profile.subtitle -}}
        <div class="home-subtitle">
            {{- if $profile.typeit -}}
                {{- $id := dict "Content" . "Scratch" $.Scratch | partial "function/id.html" -}}
                <div id="{{ $id }}" class="typeit"></div>
                {{- dict $id (slice $id) | dict "typeitMap" | merge ($.Scratch.Get "this") | $.Scratch.Set "this" -}}
            {{- else -}}
                {{- . | safeHTML -}}
            {{- end -}}
        </div>
    {{- end -}}

    {{- /* 3. 社交图标 (原版逻辑 + 微信 FontAwesome 补丁) */ -}}
    {{- if $profile.social -}}
        <div class="links">
            {{- $socialMap := resources.Get "data/social.yml" | transform.Unmarshal -}}
            {{- $socialArr := slice -}}
            {{- range $key, $value := .Site.Params.social -}}
                {{- if $value -}}
                    {{- $social := $key | lower | index $socialMap | default dict -}}
                    
                    {{- /* 补丁：如果识别到 Wechat，强制手动赋予 FontAwesome 图标属性 */ -}}
                    {{- if eq ($key | lower) "wechat" -}}
                        {{- $social = dict "Icon" "fa-brands fa-weixin" "Title" "Wechat" -}}
                    {{- end -}}

                    {{- if reflect.IsMap $value -}}
                        {{- $social = merge $social $value -}}
                    {{- else if ne $value true -}}
                        {{- $social = dict "Id" $value | merge $social -}}
                    {{- end -}}
                    {{- $socialArr = $socialArr | append $social -}}
                {{- end -}}
            {{- end -}}

            {{- range sort $socialArr "Weight" -}}
                {{- partial "plugin/social.html" . -}}
            {{- end -}}
        </div>
    {{- end -}}
</div>

<style>
    /* 样式微调，确保 FontAwesome 图标和文字一样好看 */
    .links {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-top: 1.2rem;
    }
    .links a {
        font-size: 2rem; /* 控制图标大小 */
        color: inherit;
        transition: transform 0.2s, color 0.2s;
    }
    .links a:hover {
        transform: scale(1.2);
        color: #09b83e !important; /* 悬停时变成微信绿 */
    }
</style>
